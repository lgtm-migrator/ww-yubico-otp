{"version":3,"sources":["yotp-user.js"],"names":["window","addEventListener","showError","msg","where","node","document","querySelector","parentNode","removeChild","$","insertAdjacentHTML","showSuccess","hideMessages","showSpinner","show","spinner","classList","add","btn_submit","setAttribute","remove","removeAttribute","keyAdded","this","response","status","ok","noitems","list","haveNewItems","row","message","key_name","value","otp","nonce","yotpSettings","serverError","keyRevoked","tgt","target","tagName","toUpperCase","killRow","getElementsByTagName","length","tpl","getElementById","textContent","maybeNoItems","wwU2F","bind","form","style","width","e","preventDefault","reportValidity","name","code","xhr","XMLHttpRequest","open","ajaxurl","setRequestHeader","responseType","send","encodeURIComponent","className","indexOf","confirm","revconfirm","key","dataset","req","float","margin"],"mappings":"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","file":"yotp-user.min.js","sourcesContent":["/** global: yotpSettings, ajaxurl */\nwindow.addEventListener('DOMContentLoaded', function() {\n\tvar $          = document.getElementById.bind(document);\n\tvar form       = $('new-key-form');\n\tvar spinner    = form.querySelector('.spinner');\n\tvar btn_submit = $('submit-button');\n\tvar list       = $('the-list');\n\tvar key_name   = $('key-name');\n\tvar otp        = $('otp');\n\n\tfunction showError(msg, where)\n\t{\n\t\tvar node = document.querySelector('#' + where + ' + .notice');\n\t\tnode && node.parentNode.removeChild(node);\n\t\t$(where).insertAdjacentHTML('afterend', '<div class=\"notice notice-error inline\"><p>' + msg + '</p></div>');\n\t}\n\n\tfunction showSuccess(msg, where)\n\t{\n\t\tvar node = document.querySelector('#' + where + ' + .notice');\n\t\tnode && node.parentNode.removeChild(node);\n\t\t$(where).insertAdjacentHTML('afterend', '<div class=\"notice notice-success inline\"><p>' + msg + '</p></div>');\n\t}\n\n\tfunction hideMessages()\n\t{\n\t\tvar node = document.querySelector('#new-key + .notice');\n\t\tnode && node.parentNode.removeChild(node);\n\t\tnode = document.querySelector('#registered-keys + .notice');\n\t\tnode && node.parentNode.removeChild(node);\n\t}\n\n\tfunction showSpinner(show)\n\t{\n\t\tif (show) {\n\t\t\tspinner.classList.add('is-active');\n\t\t\tbtn_submit.setAttribute('disabled', '');\n\t\t}\n\t\telse {\n\t\t\tspinner.classList.remove('is-active');\n\t\t\tbtn_submit.removeAttribute('disabled');\n\t\t}\n\t}\n\n\tfunction haveNewItems()\n\t{\n\t\tvar noitems = list.querySelector('tr.no-items')\n\t\tif (noitems) {\n\t\t\tnoitems.parentNode.removeChild(noitems);\n\t\t}\n\t}\n\n\tfunction keyAdded()\n\t{\n\t\tshowSpinner(false);\n\t\tif (null === this.response || this.status !== 200) {\n\t\t\tshowError(yotpSettings.serverError, 'new-key');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.response.ok) {\n\t\t\thaveNewItems();\n\t\t\tlist.insertAdjacentHTML('beforeend', this.response.row);\n\t\t\tshowSuccess(this.response.message, 'new-key');\n\t\t\tkey_name.value = '';\n\t\t\totp.value      = '';\n\t\t\t$('_wpnonce').value = this.response.nonce;\n\t\t}\n\t\telse {\n\t\t\tshowError(this.response.message, 'new-key');\n\t\t}\n\t}\n\n\tfunction killRow(target)\n\t{\n\t\twhile (target !== null && target.tagName.toUpperCase() !== 'TR') {\n\t\t\ttarget = target.parentNode;\n\t\t}\n\n\t\ttarget && target.parentNode.removeChild(target);\n\t}\n\n\tfunction maybeNoItems()\n\t{\n\t\tif (!list.getElementsByTagName('tr').length) {\n\t\t\tvar tpl = document.getElementById('tpl-empty').textContent;\n\t\t\tlist.insertAdjacentHTML('beforeend', tpl);\n\t\t}\n\t}\n\n\tfunction keyRevoked()\n\t{\n\t\tvar spinner = this.tgt.querySelector('.spinner');\n\t\tspinner.classList.remove('is-active');\n\n\t\tif (null === this.response || this.status !== 200) {\n\t\t\tshowError(wwU2F.serverError, 'registered-keys');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.response.ok) {\n\t\t\tshowSuccess(this.response.message, 'registered-keys');\n\t\t\tkillRow(this.tgt);\n\t\t\tmaybeNoItems();\n\t\t}\n\t\telse {\n\t\t\tshowError(this.response.message, 'registered-keys');\n\t\t}\n\t}\n\n\tdocument.querySelector('table.yotp th.column-actions').style.width = 0;\n\n\tform.addEventListener('submit', function(e) {\n\t\te.preventDefault();\n\t\tif (form.reportValidity()) {\n\t\t\tvar name  = key_name.value;\n\t\t\tvar code  = otp.value;\n\t\t\tvar nonce = $('_wpnonce').value;\n\t\t\tvar xhr   = new XMLHttpRequest();\n\n\t\t\thideMessages();\n\t\t\tshowSpinner(true);\n\t\t\txhr.open('POST', ajaxurl);\n\t\t\txhr.addEventListener('load', keyAdded);\n\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\t\t\txhr.responseType = 'json';\n\t\t\txhr.send(\n\t\t\t\t   'action=wwyotp_register'\n\t\t\t\t+ '&n=' + encodeURIComponent(name) \n\t\t\t\t+ '&o=' + encodeURIComponent(code)\n\t\t\t\t+ '&_wpnonce=' + encodeURIComponent(nonce)\n\t\t\t);\n\t\t}\n\t});\n\n\tdocument.querySelector('table.yotp > tbody').addEventListener('click', function(e) {\n\t\tvar target = e.target;\n\t\twhile (target !== null && (!target.tagName || target.tagName.toUpperCase() !== 'BUTTON' || target.className.indexOf('revoke-button') === -1)) {\n\t\t\ttarget = target.parentNode;\n\t\t}\n\n\t\tif (target && confirm(yotpSettings.revconfirm)) {\n\t\t\tvar key    = target.dataset.key;\n\t\t\tvar nonce  = target.dataset.nonce;\n\t\t\tvar req    = new XMLHttpRequest();\n\t\t\treq.tgt    = target;\n\t\t\treq.addEventListener('load', keyRevoked);\n\t\t\treq.open('POST', ajaxurl);\n\t\t\treq.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\t\t\treq.responseType = 'json';\n\n\t\t\tvar spinner = target.querySelector('.spinner');\n\t\t\tspinner.style.float = 'none';\n\t\t\tspinner.style.margin = 0;\n\t\t\tspinner.classList.add('is-active');\n\t\t\thideMessages();\n\n\t\t\treq.send(\n\t\t\t\t  'action=wwyotp_revoke'\n\t\t\t\t+ '&key=' + encodeURIComponent(key) \n\t\t\t\t+ '&_wpnonce=' + encodeURIComponent(nonce)\n\t\t\t);\n\t\t}\n\t});\n});\n"]}